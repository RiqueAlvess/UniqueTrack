{% extends "base.html" %}
{% block title %}Relatórios{% endblock %}

{% block content %}
<div class="p-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="fw-bold mb-0">Histórico de Relatórios</h5>
    <a href="{% url 'relatorio_create' %}" class="btn btn-primary btn-sm">
      <i class="bi bi-plus"></i> Novo
    </a>
  </div>

  {% for rel in relatorios %}
  <div class="card mb-2">
    <div class="card-body">
      <!-- Cabeçalho -->
      <div class="d-flex justify-content-between">
        <strong>{{ rel.data }}</strong>
        {% if rel.status_envio == 'enviado' %}
          <span class="text-success small"><i class="bi bi-check-circle"></i> Enviado</span>
        {% else %}
          <span class="text-danger small"><i class="bi bi-x-circle"></i> Não enviado</span>
        {% endif %}
      </div>

      <!-- Resumo -->
      <div class="small text-muted">
        Limpos: {{ rel.total_cleaned }} &nbsp;|&nbsp; Drops: {{ rel.forecasted_drops }}
      </div>

      {% if rel.mensagem_personalizada %}
        <div class="small fst-italic text-muted mt-1">
          “{{ rel.mensagem_personalizada|truncatechars:60 }}”
        </div>
      {% endif %}

      <!-- Ações -->
      <div class="d-flex gap-2 mt-2">
        {% if rel.status_envio != 'enviado' %}
          <a href="{% url 'relatorio_send_email' rel.pk %}" class="btn btn-outline-primary btn-sm">Enviar</a>
        {% endif %}
        <button class="btn btn-outline-secondary btn-sm copy-btn"
                data-url="{% url 'relatorio_copy' rel.pk %}">
          Copiar
        </button>
      </div>
    </div>
  </div>
  {% empty %}
    <p class="text-center text-muted">Nenhum relatório ainda.</p>
  {% endfor %}
</div>
{% endblock %}
